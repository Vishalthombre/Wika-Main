  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>User Dashboard - Raise Ticket</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">

  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-8 bg-white shadow p-4 rounded-4">
        <h3 class="mb-4">Raise Maintenance Ticket</h3>

        <form action="/ticket/submit" method="POST">

          <!-- Category -->
          <div class="mb-3">
            <label for="category" class="form-label">Category</label>
            <select class="form-select" name="category" id="category" required>
              <option value="">Select</option>
              <option value="Breakdown">Breakdown</option>
              <option value="Facility Service">Facility Service</option>
              <option value="Safety">Safety</option>
            </select>
          </div>

          <!-- Breakdown & Safety Sub-Category -->
          <div class="mb-3" id="general-sub">
            <label for="sub_category" class="form-label">Sub-Category</label>
            <select class="form-select" name="sub_category" id="sub_category">
              <option value="">Select Category First</option>
            </select>
          </div>

          <!-- Facility Service Fields -->
          <div id="facility-fields" style="display: none;">
            <div class="mb-3">
              <label for="building_no" class="form-label">Building No.</label>
              <select class="form-select" id="building_no" name="building_no">
                <option value="">Select Building</option>
                <option value="Building No. 1 (Main Building)">Building No. 1 (Main Building)</option>
                <option value="Building No. 2 (Utility - 1 Building)">Building No. 2</option>
                <option value="Building No. 3 (Canteen Building)">Building No. 3</option>
                <option value="Building No. 4 (Lvl Building)">Building No. 4</option>
                <option value="Building No. 5 (Utility - 2 Building)">Building No. 5</option>
                <option value="Building No. 6 (FMM)">Building No. 6</option>
                <option value="Building No. 7 (Skid Building)">Building No. 7</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="area_code" class="form-label">Area Code</label>
              <select class="form-select" id="area_code" name="area_code">
                <option value="">Select Area Code</option>
                <option value="Ground Floor">Ground Floor</option>
                <option value="First Floor">First Floor</option>
                <option value="Washroom">Washroom</option>
                <option value="Basement">Basement</option>
                <option value="Mezzanine Floor">Mezzanine Floor</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="sub_area" class="form-label">Sub Area</label>
              <select class="form-select" id="sub_area" name="sub_area">
                <option value="">Select Sub Area</option>
                <option value="Assembly Shop">Assembly Shop</option>
                <option value="Pantry">Pantry</option>
                <option value="Toilet A">Toilet A</option>
                <option value="Toilet B">Toilet B</option>
                <option value="CNC Room">CNC Room</option>
                <option value="Compressor Room">Compressor Room</option>
                <option value="Panel Room">Panel Room</option>
                <option value="Kitchen">Kitchen</option>
                <option value="Dining Hall">Dining Hall</option>
                <option value="HR Office">HR Office</option>
                <option value="Planning Office">Planning Office</option>
              </select>
            </div>
          </div>

          <!-- Description -->
          <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea class="form-control" name="description" id="description" rows="4" required></textarea>
          </div>

          <button type="submit" class="btn btn-primary">Submit Ticket</button>
        </form>

        <hr class="my-4">

        <h4>ðŸ“‹ My Submitted Tickets</h4>

        <% if (tickets.length === 0) { %>
          <p>You havenâ€™t submitted any tickets yet.</p>
        <% } else { %>
          <div class="table-responsive">
            <table class="table table-bordered">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>Category</th>
                  <th>Sub Category</th>
                  <th>Description</th>
                  <th>Status</th>
                  <th>Assigned To</th>
                  <th>Completion Note</th>
                </tr>
              </thead>
              <tbody>
                <% tickets.forEach(ticket => { %>
                  <tr>
                    <td><%= ticket.id %></td>
                    <td><%= ticket.category %></td>
                    <td><%= ticket.sub_category %></td>
                    <td><%= ticket.description %></td>
                    <td><%= ticket.status %></td>
                    <td><%= ticket.assigned_to_name || 'Not Assigned' %></td>
                    <td><%= ticket.completion_note || '-' %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      </div>
    </div>
  </div>

  <script>
    const subcategories = {
      "Breakdown": ["Machine Failure", "Power Cut", "Mechanical Jam"],
      "Safety": ["Fire Hazard", "Electrical Risk", "Blocked Exits"]
    };

    function toggleCategoryFields() {
      const category = document.getElementById("category").value;
      const generalSub = document.getElementById("general-sub");
      const facilityFields = document.getElementById("facility-fields");

      if (category === "Facility Service") {
        facilityFields.style.display = "block";
        generalSub.style.display = "none";
      } else {
        facilityFields.style.display = "none";
        generalSub.style.display = "block";
        populateSubcategories();
      }
    }

    function populateSubcategories() {
      const category = document.getElementById("category").value;
      const subSelect = document.getElementById("sub_category");
      subSelect.innerHTML = '';

      if (subcategories[category]) {
        subcategories[category].forEach(sub => {
          const opt = new Option(sub, sub);
          subSelect.add(opt);
        });
      } else {
        const opt = new Option("Select Category First", "");
        subSelect.add(opt);
      }
    }

    document.getElementById("category").addEventListener("change", toggleCategoryFields);

    // Load defaults on page load
    window.onload = () => {
      toggleCategoryFields();
    };
  </script>

  </body>
  </html>
